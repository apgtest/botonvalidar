<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validador de Planificaciones - Ciencias Naturales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-green-50 to-blue-50 min-h-screen">
    
    <div class="p-4 md:p-6">
        <div class="max-w-5xl mx-auto">
            
            <!-- ========== ENCABEZADO ========== -->
            <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 mb-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="bg-gradient-to-br from-green-500 to-blue-500 p-4 rounded-xl">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-blue-600">
                            Validador de Planificaciones
                        </h1>
                        <p class="text-gray-600 text-sm md:text-base mt-1">
                            Sistema de validaci√≥n autom√°tica para Ciencias Naturales
                        </p>
                    </div>
                </div>
                
                <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                    <p class="text-sm text-green-800">
                        <strong>‚úÖ 100% Gratuito:</strong> Validaci√≥n autom√°tica basada en 10 criterios obligatorios seg√∫n est√°ndares pedag√≥gicos
                    </p>
                </div>
            </div>

            <!-- ========== √ÅREA DE CARGA ========== -->
            <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    Subir Planificaci√≥n para Validar
                </h2>
                
                <div id="dropZone" class="border-3 border-dashed border-green-300 rounded-xl p-12 text-center hover:border-green-500 hover:bg-green-50 transition-all cursor-pointer">
                    <svg class="w-20 h-20 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <p class="text-gray-700 text-lg mb-4 font-medium">
                        Arrastra tu planificaci√≥n aqu√≠ o haz clic para seleccionar
                    </p>
                    <label class="inline-block bg-gradient-to-r from-green-600 to-blue-600 text-white px-8 py-4 rounded-xl cursor-pointer hover:from-green-700 hover:to-blue-700 transition-all shadow-lg font-semibold">
                        üìÅ Seleccionar Archivo
                        <input type="file" id="fileInput" accept=".pdf,.doc,.docx" class="hidden">
                    </label>
                    <p class="text-sm text-gray-500 mt-4">
                        ‚úÖ Formatos: PDF, Word (.doc, .docx) ‚Ä¢ M√°ximo 10MB
                    </p>
                </div>

                <div id="archivoNombre" class="mt-6 hidden">
                    <div class="flex items-center gap-3 bg-green-50 border border-green-200 p-4 rounded-lg">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Archivo cargado:</p>
                            <p class="font-semibold text-gray-800" id="nombreArchivo"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== PROCESANDO ========== -->
            <div id="procesando" class="bg-white rounded-xl shadow-2xl p-12 text-center hidden">
                <div class="relative mx-auto mb-6" style="width: 80px; height: 80px;">
                    <div class="absolute top-0 left-0 w-full h-full border-8 border-green-200 rounded-full"></div>
                    <div class="absolute top-0 left-0 w-full h-full border-8 border-green-600 rounded-full border-t-transparent animate-spin"></div>
                </div>
                <p class="text-gray-800 font-bold text-xl mb-3">
                    üîç Analizando su planificaci√≥n...
                </p>
                <p class="text-gray-600 mb-4">Validando los 10 criterios obligatorios</p>
                <div class="max-w-md mx-auto text-left space-y-2 text-sm">
                    <div class="flex items-center gap-2 text-gray-600">
                        <span class="animate-pulse">‚è≥</span> Extrayendo contenido del documento
                    </div>
                    <div class="flex items-center gap-2 text-gray-600">
                        <span class="animate-pulse">‚è≥</span> Validando datos generales
                    </div>
                    <div class="flex items-center gap-2 text-gray-600">
                        <span class="animate-pulse">‚è≥</span> Verificando objetivos y competencias
                    </div>
                    <div class="flex items-center gap-2 text-gray-600">
                        <span class="animate-pulse">‚è≥</span> Analizando estrategias PHET
                    </div>
                    <div class="flex items-center gap-2 text-gray-600">
                        <span class="animate-pulse">‚è≥</span> Revisando evaluaci√≥n y recursos
                    </div>
                </div>
            </div>

            <!-- ========== RESULTADOS ========== -->
            <div id="resultado" class="hidden rounded-xl shadow-2xl p-6 md:p-8">
                <div class="flex flex-col md:flex-row items-center gap-6 mb-8">
                    <svg id="iconoResultado" class="w-24 h-24 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div class="flex-1 text-center md:text-left">
                        <h3 id="mensajeResultado" class="text-3xl font-bold mb-3"></h3>
                        <div class="inline-flex items-center gap-3 bg-white px-6 py-3 rounded-xl shadow-md">
                            <svg class="w-8 h-8 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                            <div>
                                <p class="text-sm text-gray-600">Puntaje Total</p>
                                <p class="text-3xl font-bold text-gray-800">
                                    <span id="puntaje"></span><span class="text-xl text-gray-500">/10</span>
                                </p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <span id="nivelBadge" class="inline-block px-4 py-2 rounded-full text-sm font-semibold"></span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 mb-6 border-l-4" id="interpretacionBox">
                    <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Interpretaci√≥n del Resultado
                    </h4>
                    <p id="interpretacion" class="text-gray-700"></p>
                </div>

                <div class="bg-white rounded-xl p-6 mb-6">
                    <h4 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        Evaluaci√≥n Detallada por Criterios
                    </h4>
                    <div id="detalles" class="space-y-3"></div>
                </div>

                <div id="recomendaciones" class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6 border-l-4 border-yellow-500">
                    <h4 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        Recomendaciones para Mejorar
                    </h4>
                    <ul id="listaRecomendaciones" class="space-y-3"></ul>
                </div>

                <button onclick="reiniciar()" class="mt-8 w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-4 rounded-xl hover:from-green-700 hover:to-blue-700 transition-all font-semibold shadow-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Validar Otra Planificaci√≥n
                </button>
            </div>

            <!-- ========== INFORMACI√ìN ADICIONAL ========== -->
            <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 mt-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    ¬øC√≥mo funciona el validador?
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <h4 class="font-bold text-blue-900 mb-2">üìã 10 Criterios Obligatorios</h4>
                        <p class="text-sm text-blue-800">El sistema eval√∫a cada uno de los 10 elementos requeridos en una planificaci√≥n de Ciencias Naturales</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                        <h4 class="font-bold text-green-900 mb-2">üéØ An√°lisis Espec√≠fico</h4>
                        <p class="text-sm text-green-800">Busca elementos espec√≠ficos como objetivos en infinitivo, menciones de PHET, instrumentos de evaluaci√≥n, etc.</p>
                    </div>
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-lg">
                        <h4 class="font-bold text-purple-900 mb-2">üìä Puntaje sobre 10</h4>
                        <p class="text-sm text-purple-800">Cada criterio cumplido suma 1 punto. El total determina el nivel de su planificaci√≥n.</p>
                    </div>
                    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-lg">
                        <h4 class="font-bold text-orange-900 mb-2">üí° Recomendaciones</h4>
                        <p class="text-sm text-orange-800">Recibe sugerencias espec√≠ficas para completar o mejorar los criterios faltantes.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        /*
         * =====================================================================
         * VALIDADOR DE PLANIFICACIONES DE CIENCIAS NATURALES CON PHET
         * Sistema de validaci√≥n autom√°tica sin IA (100% gratuito)
         * =====================================================================
         * 
         * FUNCIONAMIENTO GENERAL:
         * 1. Extrae el texto completo del documento (PDF o Word)
         * 2. Analiza el texto buscando patrones espec√≠ficos para cada criterio
         * 3. Asigna un puntaje de 0-10 seg√∫n criterios cumplidos
         * 4. Genera recomendaciones personalizadas
         * =====================================================================
         */

        // ========== VARIABLES GLOBALES ==========
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');

        // ========== DEFINICI√ìN DE CRITERIOS Y PATRONES DE B√öSQUEDA ==========
        /*
         * Cada criterio tiene:
         * - nombre: Descripci√≥n del criterio
         * - patrones: Arrays de t√©rminos que deben estar presentes
         * - validacion: Funci√≥n personalizada para validar el criterio
         * - minimo: Cantidad m√≠nima de patrones que deben encontrarse
         */
        
        const CRITERIOS = {
            1: {
                nombre: 'Datos generales',
                descripcion: 'Incluye instituci√≥n, √°rea, grado, fecha, docente y nombre de la unidad o tema',
                // Patrones divididos por categor√≠as para validaci√≥n m√°s precisa
                patrones: {
                    institucion: ['instituci√≥n', 'colegio', 'escuela', 'unidad educativa', 'centro educativo'],
                    area: ['√°rea:', 'asignatura:', 'ciencias naturales', 'c.c.n.n'],
                    grado: ['grado:', 'curso:', 'a√±o:', 'nivel:', '¬∞', 'octavo', 'noveno', 'd√©cimo'],
                    fecha: ['fecha:', '/', '202', '2025', 'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio'],
                    docente: ['docente:', 'profesor:', 'maestro:', 'facilitador:', 'nombre:'],
                    tema: ['tema:', 'unidad:', 'contenido:', 'energ√≠a', 'materia', '√°tomo']
                },
                minimo: 4, // Deben cumplirse al menos 4 de las 6 subcategor√≠as
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let cumplidos = 0;
                    const detalles = [];
                    
                    // Validar cada subcategor√≠a
                    for (const [categoria, terminos] of Object.entries(this.patrones)) {
                        const encontrado = terminos.some(term => textoLower.includes(term.toLowerCase()));
                        if (encontrado) {
                            cumplidos++;
                            detalles.push(`‚úì ${categoria}`);
                        } else {
                            detalles.push(`‚úó ${categoria}`);
                        }
                    }
                    
                    return {
                        cumple: cumplidos >= this.minimo,
                        puntaje: cumplidos,
                        detalles: detalles.join(', ')
                    };
                }
            },
            
            2: {
                nombre: 'Objetivos de aprendizaje',
                descripcion: 'Redactados con verbos en infinitivo, son medibles y coherentes con el curr√≠culo',
                // Verbos en infinitivo t√≠picos de objetivos de aprendizaje
                verbosInfinitivo: [
                    'identificar', 'reconocer', 'describir', 'explicar', 'analizar',
                    'comparar', 'contrastar', 'sintetizar', 'evaluar', 'aplicar',
                    'comprender', 'demostrar', 'interpretar', 'relacionar', 'determinar'
                ],
                indicadores: ['objetivo', 'lograr', 'alcanzar', 'pretende', 'se espera'],
                minimo: 2,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let verbosEncontrados = 0;
                    let tieneIndicador = false;
                    
                    // Buscar verbos en infinitivo
                    this.verbosInfinitivo.forEach(verbo => {
                        if (textoLower.includes(verbo)) verbosEncontrados++;
                    });
                    
                    // Buscar indicadores de objetivos
                    tieneIndicador = this.indicadores.some(ind => textoLower.includes(ind));
                    
                    const cumple = verbosEncontrados >= this.minimo && tieneIndicador;
                    
                    return {
                        cumple: cumple,
                        puntaje: verbosEncontrados,
                        detalles: `Verbos encontrados: ${verbosEncontrados}, Indicador: ${tieneIndicador ? 'S√≠' : 'No'}`
                    };
                }
            },
            
            3: {
                nombre: 'Competencia o destreza del curr√≠culo',
                descripcion: 'Se evidencia la relaci√≥n con las destrezas o criterios de evaluaci√≥n del √°rea de Ciencias Naturales',
                patrones: [
                    'competencia', 'destreza', 'criterio de evaluaci√≥n', 'indicador de logro',
                    'c.n.', 'e.cn', 'cn.5', 'curr√≠culo', 'est√°ndar', 'objetivo de √°rea'
                ],
                minimo: 2,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let coincidencias = 0;
                    
                    this.patrones.forEach(patron => {
                        if (textoLower.includes(patron.toLowerCase())) coincidencias++;
                    });
                    
                    return {
                        cumple: coincidencias >= this.minimo,
                        puntaje: coincidencias,
                        detalles: `Referencias encontradas: ${coincidencias}`
                    };
                }
            },
            
            4: {
                nombre: 'Estrategias metodol√≥gicas',
                descripcion: 'Describe estrategias activas o experimentales que incluyan el uso del programa PHET',
                // ESTE ES EL CRITERIO M√ÅS IMPORTANTE: uso de PHET
                patronesPHET: ['phet', 'ph.e.t', 'simulaci√≥n', 'laboratorio virtual', 'simulador'],
                estrategias: [
                    'aprendizaje activo', 'indagaci√≥n', 'experimentaci√≥n', 'm√©todo cient√≠fico',
                    'trabajo colaborativo', 'aprendizaje basado', 'observaci√≥n', 'manipulaci√≥n'
                ],
                minimo: 2, // Debe mencionar PHET + al menos una estrategia
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let tienePHET = false;
                    let estrategiasEncontradas = 0;
                    
                    // Verificar menci√≥n de PHET (CR√çTICO)
                    tienePHET = this.patronesPHET.some(patron => textoLower.includes(patron.toLowerCase()));
                    
                    // Contar estrategias metodol√≥gicas
                    this.estrategias.forEach(estrategia => {
                        if (textoLower.includes(estrategia.toLowerCase())) estrategiasEncontradas++;
                    });
                    
                    const cumple = tienePHET && estrategiasEncontradas >= 1;
                    
                    return {
                        cumple: cumple,
                        puntaje: (tienePHET ? 1 : 0) + estrategiasEncontradas,
                        detalles: `PHET: ${tienePHET ? 'S√≠' : 'No'}, Estrategias: ${estrategiasEncontradas}`
                    };
                }
            },
            
            5: {
                nombre: 'Secuencia did√°ctica',
                descripcion: 'Se detalla el inicio, desarrollo y cierre de la clase con tiempos aproximados',
                fases: {
                    inicio: ['inicio', 'anticipaci√≥n', 'motivaci√≥n', 'saberes previos', 'activaci√≥n'],
                    desarrollo: ['desarrollo', 'construcci√≥n', 'elaboraci√≥n', 'actividad', 'trabajo'],
                    cierre: ['cierre', 'consolidaci√≥n', 'conclusi√≥n', 's√≠ntesis', 'evaluaci√≥n']
                },
                tiempos: ['minutos', 'min', 'hora', 'tiempo', 'duraci√≥n', '10', '15', '20', '30'],
                minimo: 3, // Deben estar las 3 fases
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let fasesEncontradas = 0;
                    let tieneTiempos = false;
                    const detalles = [];
                    
                    // Verificar cada fase
                    for (const [fase, terminos] of Object.entries(this.fases)) {
                        const encontrado = terminos.some(term => textoLower.includes(term));
                        if (encontrado) {
                            fasesEncontradas++;
                            detalles.push(`‚úì ${fase}`);
                        } else {
                            detalles.push(`‚úó ${fase}`);
                        }
                    }
                    
                    // Verificar menci√≥n de tiempos
                    tieneTiempos = this.tiempos.some(tiempo => textoLower.includes(tiempo));
                    
                    return {
                        cumple: fasesEncontradas === 3 && tieneTiempos,
                        puntaje: fasesEncontradas,
                        detalles: `${detalles.join(', ')}, Tiempos: ${tieneTiempos ? 'S√≠' : 'No'}`
                    };
                }
            },
            
            6: {
                nombre: 'Recursos y materiales',
                descripcion: 'Se incluyen los recursos digitales (PHET), materiales f√≠sicos, fichas o gu√≠as de trabajo',
                digital: ['phet', 'computador', 'ordenador', 'internet', 'proyector', 'simulaci√≥n', 'digital'],
                fisico: ['material', 'recurso', 'gu√≠a', 'ficha', 'hoja', 'cuaderno', 'laboratorio'],
                minimo: 3,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let digitalEncontrados = 0;
                    let fisicoEncontrados = 0;
                    
                    this.digital.forEach(item => {
                        if (textoLower.includes(item)) digitalEncontrados++;
                    });
                    
                    this.fisico.forEach(item => {
                        if (textoLower.includes(item)) fisicoEncontrados++;
                    });
                    
                    const totalRecursos = digitalEncontrados + fisicoEncontrados;
                    const tienePHET = textoLower.includes('phet');
                    
                    return {
                        cumple: totalRecursos >= this.minimo && tienePHET,
                        puntaje: totalRecursos,
                        detalles: `Digitales: ${digitalEncontrados}, F√≠sicos: ${fisicoEncontrados}, PHET: ${tienePHET ? 'S√≠' : 'No'}`
                    };
                }
            },
            
            7: {
                nombre: 'Evaluaci√≥n del aprendizaje',
                descripcion: 'Incluye indicadores claros, instrumentos (r√∫bricas, listas de cotejo, etc.) y criterios de logro',
                instrumentos: ['r√∫brica', 'rubrica', 'lista de cotejo', 'escala', 'matriz', 'instrumento'],
                indicadores: ['indicador', 'criterio', 'logro', 'desempe√±o', 'valoraci√≥n'],
                tipos: ['formativa', 'sumativa', 'evaluaci√≥n', 'evaluar', 'calificaci√≥n'],
                minimo: 2,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let instrumentosEncontrados = 0;
                    let indicadoresEncontrados = 0;
                    let tiposEncontrados = 0;
                    
                    this.instrumentos.forEach(inst => {
                        if (textoLower.includes(inst)) instrumentosEncontrados++;
                    });
                    
                    this.indicadores.forEach(ind => {
                        if (textoLower.includes(ind)) indicadoresEncontrados++;
                    });
                    
                    this.tipos.forEach(tipo => {
                        if (textoLower.includes(tipo)) tiposEncontrados++;
                    });
                    
                    const total = instrumentosEncontrados + indicadoresEncontrados + tiposEncontrados;
                    const tieneInstrumento = instrumentosEncontrados > 0;
                    
                    return {
                        cumple: total >= this.minimo && tieneInstrumento,
                        puntaje: total,
                        detalles: `Instrumentos: ${instrumentosEncontrados}, Indicadores: ${indicadoresEncontrados}, Tipos: ${tiposEncontrados}`
                    };
                }
            },
            
            8: {
                nombre: 'Integraci√≥n de TIC/PHET',
                descripcion: 'Se evidencia de manera espec√≠fica c√≥mo y en qu√© momento se emplea la simulaci√≥n PHET',
                // Este criterio es MUY ESPEC√çFICO: debe mencionar C√ìMO se usa PHET
                patronesIntegracion: [
                    'mediante phet', 'usando phet', 'con phet', 'a trav√©s de phet',
                    'simulaci√≥n de', 'en la simulaci√≥n', 'utilizando la simulaci√≥n',
                    'interactuar con', 'explorar en', 'manipular', 'observar en phet'
                ],
                momentos: ['durante', 'momento', 'fase', 'despu√©s', 'antes', 'inicio', 'desarrollo'],
                minimo: 2,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let integracionEncontrada = false;
                    let momentoEspecificado = false;
                    let conteoIntegracion = 0;
                    
                    // Buscar descripciones de c√≥mo se integra PHET
                    this.patronesIntegracion.forEach(patron => {
                        if (textoLower.includes(patron.toLowerCase())) {
                            integracionEncontrada = true;
                            conteoIntegracion++;
                        }
                    });
                    
                    // Verificar si especifica momento
                    momentoEspecificado = this.momentos.some(momento => textoLower.includes(momento));
                    
                    return {
                        cumple: integracionEncontrada && momentoEspecificado,
                        puntaje: conteoIntegracion,
                        detalles: `Integraci√≥n espec√≠fica: ${integracionEncontrada ? 'S√≠' : 'No'}, Momento: ${momentoEspecificado ? 'S√≠' : 'No'}`
                    };
                }
            },
            
            9: {
                nombre: 'Atenci√≥n a la diversidad',
                descripcion: 'Contempla estrategias para estudiantes con diferentes ritmos o necesidades educativas',
                patrones: [
                    'diversidad', 'ritmo', 'necesidades educativas', 'nee', 'adaptaci√≥n',
                    'diferenciaci√≥n', 'inclusi√≥n', 'apoyo', 'refuerzo', 'ampliaci√≥n',
                    'estudiantes con', 'velocidad de comprensi√≥n', 'diferentes niveles'
                ],
                minimo: 2,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let coincidencias = 0;
                    
                    this.patrones.forEach(patron => {
                        if (textoLower.includes(patron.toLowerCase())) coincidencias++;
                    });
                    
                    return {
                        cumple: coincidencias >= this.minimo,
                        puntaje: coincidencias,
                        detalles: `Referencias a diversidad: ${coincidencias}`
                    };
                }
            },
            
            10: {
                nombre: 'Reflexi√≥n docente o mejora',
                descripcion: 'Incluye una breve autoevaluaci√≥n o ajustes para futuras clases',
                patrones: [
                    'reflexi√≥n', 'autoevaluaci√≥n', 'mejora', 'ajuste', 'modificaci√≥n',
                    'observaci√≥n', 'funcion√≥', 'no funcion√≥', 'mejorar', 'pr√≥xima vez',
                    'sugerencia', 'recomendaci√≥n', 'cambiar', 'adaptar'
                ],
                minimo: 2,
                validar: function(texto) {
                    const textoLower = texto.toLowerCase();
                    let coincidencias = 0;
                    
                    this.patrones.forEach(patron => {
                        if (textoLower.includes(patron.toLowerCase())) coincidencias++;
                    });
                    
                    return {
                        cumple: coincidencias >= this.minimo,
                        puntaje: coincidencias,
                        detalles: `Referencias a reflexi√≥n: ${coincidencias}`
                    };
                }
            }
        };

        // ========== EVENTOS DE MANEJO DE ARCHIVOS ==========
        
        /*
         * Evento: Cuando el usuario selecciona un archivo con el bot√≥n
         * Extrae el archivo y lo env√≠a a procesar
         */
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) procesarArchivo(file);
        });

        /*
         * Evento: Permitir arrastrar archivos sobre la zona
         * Cambia estilos visuales para indicar que se puede soltar
         */
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-green-500', 'bg-green-50');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-green-500', 'bg-green-50');
        });

        /*
         * Evento: Cuando el usuario suelta un archivo en la zona
         * Valida que sea PDF o Word y lo procesa
         */
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-green-500', 'bg-green-50');
            const file = e.dataTransfer.files[0];
            if (file) {
                const extension = file.name.split('.').pop().toLowerCase();
                if (['pdf', 'doc', 'docx'].includes(extension)) {
                    procesarArchivo(file);
                } else {
                    alert('‚ö†Ô∏è Por favor, suba solo archivos PDF o Word (.doc, .docx)');
                }
            }
        });

        // ========== FUNCI√ìN PRINCIPAL: PROCESAR ARCHIVO ==========
        
        /*
         * Funci√≥n principal que coordina todo el proceso de validaci√≥n
         * 1. Valida tama√±o del archivo
         * 2. Muestra animaci√≥n de procesamiento
         * 3. Extrae texto del documento
         * 4. Analiza seg√∫n los 10 criterios
         * 5. Muestra resultados
         */
        async function procesarArchivo(file) {
            // Validar tama√±o m√°ximo (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('‚ö†Ô∏è El archivo es muy grande. Por favor, suba un archivo menor a 10MB.');
                return;
            }

            // Mostrar nombre del archivo
            document.getElementById('nombreArchivo').textContent = file.name;
            document.getElementById('archivoNombre').classList.remove('hidden');
            
            // Mostrar animaci√≥n de procesamiento
            document.getElementById('procesando').classList.remove('hidden');
            
            try {
                // PASO 1: Extraer texto del documento
                const texto = await extraerTexto(file);
                
                // Validar que se extrajo contenido suficiente
                if (!texto || texto.length < 50) {
                    throw new Error('El documento est√° vac√≠o o no se pudo leer correctamente. Aseg√∫rese de que contenga texto legible.');
                }

                // PASO 2: Simular tiempo de procesamiento (mejora UX)
                await new Promise(resolve => setTimeout(resolve, 2500));

                // PASO 3: Analizar documento seg√∫n criterios
                const analisis = analizarDocumento(texto);

                // PASO 4: Ocultar procesamiento y mostrar resultados
                document.getElementById('procesando').classList.add('hidden');
                mostrarResultado(analisis);

            } catch (error) {
                console.error('Error al procesar:', error);
                document.getElementById('procesando').classList.add('hidden');
                alert('‚ùå Error al procesar el archivo:\n\n' + error.message + '\n\nVerifique que el documento sea un PDF o Word v√°lido con texto legible (no im√°genes escaneadas).');
                reiniciar();
            }
        }

        // ========== EXTRACCI√ìN DE TEXTO ==========
        
        /*
         * Determina el tipo de archivo y llama a la funci√≥n apropiada
         * Soporta: PDF, DOC, DOCX
         */
        async function extraerTexto(file) {
            const extension = file.name.split('.').pop().toLowerCase();
            
            if (extension === 'pdf') {
                return await extraerTextoPDF(file);
            } else if (extension === 'docx' || extension === 'doc') {
                return await extraerTextoWord(file);
            }
            throw new Error('Formato no soportado. Use PDF o Word.');
        }

        /*
         * Extrae texto de archivos PDF
         * Usa la librer√≠a PDF.js para leer el contenido
         * Procesa p√°gina por p√°gina y concatena todo el texto
         */
        async function extraerTextoPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            let textoCompleto = '';
            
            // Procesar cada p√°gina del PDF
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                textoCompleto += pageText + '\n';
            }
            
            return textoCompleto;
        }

        /*
         * Extrae texto de archivos Word (.doc, .docx)
         * Usa la librer√≠a Mammoth para leer el contenido
         */
        async function extraerTextoWord(file) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({arrayBuffer});
            return result.value;
        }

        // ========== FUNCI√ìN DE AN√ÅLISIS PRINCIPAL ==========
        
        /*
         * Analiza el texto completo del documento seg√∫n los 10 criterios
         * Retorna un objeto con:
         * - puntaje: N√∫mero total de criterios cumplidos (0-10)
         * - nivel: Clasificaci√≥n (Excelente, Muy buena, etc.)
         * - criterios: Array con detalles de cada criterio
         * - recomendaciones: Sugerencias para mejorar
         */
        function analizarDocumento(texto) {
            let puntajeTotal = 0;
            const criteriosResultado = [];
            const recomendaciones = [];

            // Analizar cada uno de los 10 criterios
            for (let i = 1; i <= 10; i++) {
                const criterio = CRITERIOS[i];
                
                // Ejecutar la funci√≥n de validaci√≥n espec√≠fica del criterio
                const resultado = criterio.validar(texto);
                
                // Si cumple el criterio, sumar al puntaje
                if (resultado.cumple) {
                    puntajeTotal++;
                }

                // Guardar resultado del criterio
                criteriosResultado.push({
                    numero: i,
                    nombre: criterio.nombre,
                    descripcion: criterio.descripcion,
                    cumple: resultado.cumple,
                    detalles: resultado.detalles,
                    puntaje: resultado.puntaje
                });

                // Si no cumple, generar recomendaci√≥n
                if (!resultado.cumple) {
                    recomendaciones.push(generarRecomendacion(i, criterio.nombre));
                }
            }

            // Determinar nivel seg√∫n puntaje obtenido
            let nivel;
            if (puntajeTotal === 10) {
                nivel = 'Excelente';
            } else if (puntajeTotal >= 8) {
                nivel = 'Muy buena';
            } else if (puntajeTotal >= 6) {
                nivel = 'Aceptable';
            } else if (puntajeTotal >= 4) {
                nivel = 'Insuficiente';
            } else {
                nivel = 'Deficiente';
            }

            return {
                puntaje: puntajeTotal,
                nivel: nivel,
                criterios: criteriosResultado,
                recomendaciones: recomendaciones
            };
        }

        // ========== GENERACI√ìN DE RECOMENDACIONES ==========
        
        /*
         * Genera recomendaciones espec√≠ficas para cada criterio no cumplido
         * Basadas en las directrices mostradas en las im√°genes
         */
        function generarRecomendacion(criterioNum, nombreCriterio) {
            const recomendaciones = {
                1: 'Complete los datos generales: incluya nombre de la instituci√≥n educativa, √°rea (Ciencias Naturales), grado espec√≠fico (ej: 8¬∞ de Educaci√≥n B√°sica), fecha completa (d√≠a/mes/a√±o), nombre del docente y t√≠tulo claro de la unidad o tema (ej: "Ley de Conservaci√≥n de la Energ√≠a").',
                
                2: 'Redacte objetivos de aprendizaje claros usando verbos en infinitivo como: identificar, analizar, explicar, describir, comparar, demostrar. Ejemplo: "Describir c√≥mo la energ√≠a se transforma y conserva en diferentes sistemas f√≠sicos mediante la observaci√≥n y an√°lisis de simulaciones interactivas en PHET".',
                
                3: 'Especifique la competencia o destreza del curr√≠culo nacional de Ciencias Naturales. Ejemplo: "Reconoce las transformaciones de energ√≠a que ocurren en los sistemas naturales y tecnol√≥gicos (E.CN.5.3)". Refi√©rase al documento curricular oficial.',
                
                4: 'Describa estrategias metodol√≥gicas activas que integren PHET. Debe mencionar: a) El nombre espec√≠fico de la simulaci√≥n (ej: "Energy Skate Park"), b) La metodolog√≠a (aprendizaje activo, indagaci√≥n guiada, experimentaci√≥n), c) C√≥mo los estudiantes interactuar√°n con la simulaci√≥n.',
                
                5: 'Desarrolle una secuencia did√°ctica completa con tres momentos: INICIO (activaci√≥n de conocimientos previos mediante preguntas o video introductorio, 10-15 min), DESARROLLO (uso de la simulaci√≥n PHET para experimentar, mediciones y trabajo colaborativo, 25-30 min), CIERRE (reflexi√≥n guiada sobre c√≥mo se conserva la energ√≠a, conclusiones y presentaci√≥n oral, 10-15 min). Especifique tiempos aproximados.',
                
                6: 'Liste todos los recursos necesarios: a) Digitales: computadores con acceso a internet, simulaci√≥n PHET espec√≠fica (indique cu√°l), proyector; b) F√≠sicos: cuaderno de apuntes, gu√≠a de observaci√≥n impresa, pizarra digital; c) Materiales de apoyo: fichas de trabajo con preguntas gu√≠a.',
                
                7: 'Dise√±e instrumentos de evaluaci√≥n concretos: a) R√∫brica de desempe√±o con criterios espec√≠ficos (identifica tipos de energ√≠a: 1-5 puntos, explica conservaci√≥n de energ√≠a: 1-5 puntos, participa en trabajo colaborativo: 1-5 puntos), b) Lista de cotejo para verificar cumplimiento de tareas, c) Indicadores claros de logro.',
                
                8: 'Demuestre expl√≠citamente c√≥mo integrar√° PHET: Indique el momento exacto ("Durante el desarrollo, se utilizar√° la simulaci√≥n PHET Energy Skate Park para observar y medir la energ√≠a potencial que se convierte en cin√©tica"), la actividad espec√≠fica que realizar√°n los estudiantes ("Los estudiantes manipular√°n la altura de la rampa y registrar√°n mediciones") y c√≥mo se relaciona con el objetivo.',
                
                9: 'Contemple la atenci√≥n a la diversidad: a) Para estudiantes con menor velocidad de comprensi√≥n, proporcione una versi√≥n de la gu√≠a con im√°genes y pasos m√°s detallados; b) Para estudiantes avanzados, incluya una tabla comparativa adicional con casos m√°s complejos; c) Ofrezca apoyos visuales, m√°s tiempo si es necesario, o actividades diferenciadas.',
                
                10: 'Incluya una secci√≥n de reflexi√≥n docente breve: "El uso de PHET favoreci√≥ la participaci√≥n activa de los estudiantes. Para futuras sesiones, se sugiere: a) Reforzar la interpretaci√≥n de gr√°ficos de energ√≠a, b) Ampliar el tiempo de experimentaci√≥n libre, c) Incluir ejemplos de la vida cotidiana para conectar mejor con la realidad de los estudiantes".'
            };
            
            return recomendaciones[criterioNum] || `Complete adecuadamente el criterio: ${nombreCriterio}`;
        }

        // ========== MOSTRAR RESULTADOS ==========
        
        /*
         * Muestra los resultados del an√°lisis en la interfaz
         * Aplica estilos seg√∫n el nivel obtenido
         * Genera visualizaci√≥n de criterios y recomendaciones
         */
        function mostrarResultado(analisis) {
            const { puntaje, nivel, criterios, recomendaciones } = analisis;
            
            // Mostrar puntaje
            document.getElementById('puntaje').textContent = puntaje;
            
            // Definir estilos y mensajes seg√∫n el nivel
            const estilos = {
                'Excelente': {
                    fondo: 'bg-green-50',
                    borde: 'border-green-300',
                    icono: 'text-green-600',
                    badge: 'bg-green-100 text-green-800',
                    mensaje: 'üéâ ¬°Excelente trabajo docente! Su planificaci√≥n cumple con todos los criterios de innovaci√≥n pedag√≥gica y la integraci√≥n del programa PHET',
                    interpretacion: 'Planificaci√≥n integral, innovadora y bien estructurada. Cumple con todos los criterios establecidos.'
                },
                'Muy buena': {
                    fondo: 'bg-blue-50',
                    borde: 'border-blue-300',
                    icono: 'text-blue-600',
                    badge: 'bg-blue-100 text-blue-800',
                    mensaje: '‚≠ê Su planificaci√≥n est√° casi lista. Revise los apartados de evaluaci√≥n, estrategias o uso del programa PHET para mejorarla',
                    interpretacion: 'Cumple la mayor√≠a de los criterios con coherencia. Planificaci√≥n funcional, pero requiere revisar algunos apartados.'
                },
                'Aceptable': {
                    fondo: 'bg-yellow-50',
                    borde: 'border-yellow-300',
                    icono: 'text-yellow-600',
                    badge: 'bg-yellow-100 text-yellow-800',
                    mensaje: '‚úÖ Su planificaci√≥n es funcional pero necesita mejoras importantes',
                    interpretacion: 'Planificaci√≥n funcional, pero requiere mejoras. Revise objetivos, recursos y especialmente la integraci√≥n del programa PHET.'
                },
                'Insuficiente': {
                    fondo: 'bg-orange-50',
                    borde: 'border-orange-300',
                    icono: 'text-orange-600',
                    badge: 'bg-orange-100 text-orange-800',
                    mensaje: '‚ö†Ô∏è La planificaci√≥n presenta varias deficiencias importantes',
                    interpretacion: 'Varias secciones incompletas o incoherentes. Es necesario revisar y completar elementos fundamentales antes de implementarla.'
                },
                'Deficiente': {
                    fondo: 'bg-red-50',
                    borde: 'border-red-300',
                    icono: 'text-red-600',
                    badge: 'bg-red-100 text-red-800',
                    mensaje: '‚ùå La planificaci√≥n no cumple con los criterios m√≠nimos establecidos',
                    interpretacion: 'La planificaci√≥n no cumple con los criterios m√≠nimos. Por favor, revise objetivos, recursos y evaluaci√≥n antes de reenviar.'
                }
            };
            
            const estilo = estilos[nivel];
            
            // Aplicar estilos al contenedor principal
            const resultado = document.getElementById('resultado');
            resultado.className = `rounded-xl shadow-2xl p-6 md:p-8 ${estilo.fondo} border-2 ${estilo.borde}`;
            
            // Actualizar √≠cono y mensaje
            document.getElementById('iconoResultado').className = `w-24 h-24 flex-shrink-0 ${estilo.icono}`;
            document.getElementById('mensajeResultado').textContent = estilo.mensaje;
            document.getElementById('mensajeResultado').className = `text-3xl font-bold ${estilo.icono}`;
            
            // Actualizar badge de nivel
            document.getElementById('nivelBadge').textContent = `Nivel: ${nivel}`;
            document.getElementById('nivelBadge').className = `inline-block px-4 py-2 rounded-full text-sm font-semibold ${estilo.badge}`;
            
            // Actualizar interpretaci√≥n
            document.getElementById('interpretacion').textContent = estilo.interpretacion;
            document.getElementById('interpretacionBox').className = `bg-white rounded-xl p-6 mb-6 border-l-4 ${estilo.borde}`;
            
            // Generar HTML para los detalles de criterios
            const detallesHTML = criterios.map(c => {
                const iconoCheck = c.cumple 
                    ? '<svg class="w-6 h-6 text-green-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>'
                    : '<svg class="w-6 h-6 text-red-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>';
                
                return `
                    <div class="flex gap-3 p-4 rounded-lg ${c.cumple ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
                        ${iconoCheck}
                        <div class="flex-1">
                            <p class="font-bold text-gray-800 mb-1">
                                ${c.cumple ? '‚úÖ' : '‚ùå'} ${c.numero}. ${c.nombre}
                            </p>
                            <p class="text-sm text-gray-600 mb-1">${c.descripcion}</p>
                            <p class="text-xs ${c.cumple ? 'text-green-700' : 'text-red-700'} font-medium">
                                ${c.detalles}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('detalles').innerHTML = detallesHTML;
            
            // Mostrar recomendaciones
            if (recomendaciones.length > 0) {
                const recsHTML = recomendaciones.map((rec, i) => `
                    <li class="flex gap-3 items-start">
                        <span class="flex-shrink-0 w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center font-bold text-sm">${i+1}</span>
                        <span class="text-gray-800 text-sm">${rec}</span>
                    </li>
                `).join('');
                
                document.getElementById('listaRecomendaciones').innerHTML = recsHTML;
            } else {
                // Si no hay recomendaciones (puntaje perfecto)
                document.getElementById('recomendaciones').innerHTML = `
                    <div class="text-center py-8">
                        <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <p class="text-xl font-bold text-green-800">¬°Perfecta!</p>
                        <p class="text-gray-600">Su planificaci√≥n cumple con todos los criterios establecidos</p>
                    </div>
                `;
            }
            
            // Mostrar el contenedor de resultados y hacer scroll
            resultado.classList.remove('hidden');
            window.scrollTo({ top: resultado.offsetTop - 100, behavior: 'smooth' });
        }

        // ========== REINICIAR APLICACI√ìN ==========
        
        /*
         * Limpia todos los campos y oculta resultados
         * Permite validar otra planificaci√≥n
         */
        function reiniciar() {
            fileInput.value = '';
            document.getElementById('archivoNombre').classList.add('hidden');
            document.getElementById('resultado').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>